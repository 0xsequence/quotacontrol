# This workflow will build a golang project
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-go

name: Go

on:
   push:
    tags:        
      - '*' 

jobs:

  version:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    - name: Build
      run: >
        PROTO_VERSION=$(grep -e "^version = " ./proto/proto.ridl | cut -d "=" -f 2 | xargs);  
        TAG_VERSION=$(git describe --exact-match --tags);
        if [[ "$PROTO_VERSION" != "$TAG_VERSION" ]]; then 
          echo "Version mismatch:  $PROTO_VERSION vs $TAG_VERSION";
          exit 1; 
        fi

    - name: Test
      run: go test -v ./...
